{"version":3,"file":"nmc_welcome_popup-admin-settings.mjs","sources":["../src/js/settings-admin.js"],"sourcesContent":["/**\n * @author Björn Schießle <bjoern@schiessle.org>\n *\n * @copyright Copyright (c) 2016, Bjoern Schiessle\n * @license AGPL-3.0\n *\n * This code is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>\n *\n */\n\nvar imgUrl;\nvar en = 'en_GB';\nvar de = 'de_DE';\n\n(function(OCA) {\n\tOCA.NMC_Welcome_Popup = OCA.NMC_Welcome_Popup || {};\n\n\t/**\n\t * @namespace OCA.NMC_Welcome_Popup.Admin\n\t */\n\tOCA.NMC_Welcome_Popup.Admin = {\n\t\tcurrentConfig: '1',\n\t\tslideIds: '1',\n\t\tnoSlides: '0',\n\t\tmaxSlides: '5',\n\n\t\t_getAppConfig: function (key) {\n\t\t\treturn $.ajax({\n\t\t\t\ttype: 'GET',\n\t\t\t\turl: OC.linkToOCS('apps/provisioning_api/api/v1', 2) + 'config/apps' + '/nmc_welcome_popup/' + key + '?format=json'\n\t\t\t});\n\t\t},\n\n\t\tinit: function(callback) {\n\t\t\tthis._getAppConfig('slideIds').done(function (data){\n\t\t\t\tif (data.ocs.data.data !== '') {\n\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.slideIds = data.ocs.data.data;\n\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.currentConfig = OCA.NMC_Welcome_Popup.Admin.slideIds.split(',')[0];\n\t\t\t\t} else {\n\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.noSlides = '1';\n\t\t\t\t}\n\t\t\t\tcallback();\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Add a new slide\n\t\t * @returns {number} id of the slide\n\t\t */\n\t\taddSlide: function(callback) {\n\t\t\tvar slideIds = OCA.NMC_Welcome_Popup.Admin.slideIds.split(',');\n\t\t\tif (slideIds.length < OCA.NMC_Welcome_Popup.Admin.maxSlides) {\n\t\t\t\tvar nextId = 1;\n\t\t\t\tif (slideIds.indexOf('1') >= 0) {\n\t\t\t\t\tnextId = 2;\n\t\t\t\t\twhile ($.inArray('' + nextId, slideIds) >= 0) {\n\t\t\t\t\t\tnextId++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tOCP.AppConfig.setValue('nmc_welcome_popup', 'slideIds', OCA.NMC_Welcome_Popup.Admin.slideIds + ',' + nextId, {\n\t\t\t\t\tsuccess: function () {\n\t\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.slideIds += ',' + nextId;\n\t\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.noSlides = '0';\n\t\t\t\t\t\tcallback(nextId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tremoveSlide: function(callback) {\n\t\t\tif (OCA.NMC_Welcome_Popup.Admin.noSlides === '0') {\n\t\t\t\tvar slideIds = OCA.NMC_Welcome_Popup.Admin.slideIds.split(',');\n\t\t\t\tif (slideIds.length >= 1) {\n\t\t\t\t\tvar index = slideIds.indexOf(this.currentConfig);\n\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\tslideIds.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t\tvar config = this.currentConfig;\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: OC.generateUrl('/apps/nmc_welcome_popup/ajax/slideSettings/' + this.currentConfig),\n\t\t\t\t\t\ttype: 'DELETE'\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\tOCP.AppConfig.setValue('nmc_welcome_popup', 'slideIds', slideIds.join(','), {\n\t\t\t\t\t\t\tsuccess: function () {\n\t\t\t\t\t\t\t\tif (slideIds.length > 0) {\n\t\t\t\t\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.slideIds = slideIds.join(',');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.noSlides = '1';\n\t\t\t\t\t\t\t\t\tOCA.NMC_Welcome_Popup.Admin.slideIds = '1';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcallback(config);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n})(OCA);\n\nfunction startLoading() {\n\tOC.msg.startSaving('#welcome_settings_msg');\n\t$('#welcome_settings_loading').show();\n}\n\nfunction startLoadingImg() {\n\t// OC.msg.startSaving('#welcome_img_loaded_msg');\n\tif ($('#welcome_img_loaded_msg').is(':hidden') === false) {\n\t\t$('#welcome_img_loaded_msg').hide();\n\t}\n\t$('#welcome_img_loading').show();\n}\n\n$(function() {\n\n\tvar addSlideBtn = $('.slide-list .add-slide');\n\tvar slideDataId = '.slide-list li[data-id=';\n\n\tif ($('#slide-image').val()) {\n\t\t$('#remove-img').show();\n\t} else {\n\t\t$('#remove-img').hide();\n\t}\n\n\tif (!imgUrl) {\n\t\timgUrl = $('#slide-image').data('imgurl');\n\t\t$('#slide-image').data('imgurl', '');\n\t}\n\n\t$('#remove-img').click(function () {\n\t\tvar image_name = $('#slide-image').val();\n\t\tvar slideId = $('.slide-list .active').data('id');\n\n\t\tstartLoadingImg();\n\t\t$.ajax({\n\t\t\ttype: 'DELETE',\n\t\t\turl: OC.generateUrl('/apps/nmc_welcome_popup/image/' + image_name),\n\t\t\tdata: { 'slideId': slideId }\n\t\t}).done(function(response) {\n\t\t\tOC.msg.finishedSaving('#welcome_img_loaded_msg', response);\n\t\t\t$('#welcome_img_loading').hide();\n\t\t\t$('#slide-image').val('');\n\t\t\t$('#image-uploaded').text('');\n\t\t\t$('#remove-img').hide();\n\t\t}).fail(function(response) {\n\t\t\tOC.msg.finishedError('#welcome_img_loaded_msg', response.responseJSON.status);\n\t\t\t$('#welcome_img_loading').hide();\n\t\t});\n\t});\n\n\t/**\n\t * Ersatz für das entfernte jQuery FileUpload-Plugin:\n\t * Upload der Bild-Datei per FormData + $.ajax\n\t */\n\t$('.fileupload').on('change', function (e) {\n\t\tvar input = this;\n\t\tvar file = input.files && input.files[0];\n\t\tif (!file) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $form = $(input).closest('form');\n\t\tvar url = $form.attr('action');\n\n\t\tif (!url) {\n\t\t\t// Fallback: falls kein action-Attribut gesetzt ist, ggf. hier OC.generateUrl(...) nutzen\n\t\t\tconsole.error('No form action defined for image upload.');\n\t\t\treturn;\n\t\t}\n\n\t\tstartLoadingImg();\n\t\t$form.find('label.button')\n\t\t\t.removeClass('icon-upload')\n\t\t\t.addClass('icon-loading-small');\n\n\t\tvar formData = new FormData($form[0]);\n\t\t// sicherstellen, dass die Datei im FormData ist\n\t\tvar fieldName = $(input).attr('name') || 'file';\n\t\tformData.set(fieldName, file);\n\n\t\t$.ajax({\n\t\t\turl: url,\n\t\t\tmethod: 'POST',\n\t\t\tdata: formData,\n\t\t\tprocessData: false,\n\t\t\tcontentType: false,\n\t\t\tsuccess: function (response) {\n\t\t\t\t// hier ist response das, was vorher response.result war\n\t\t\t\tif (response && response.data) {\n\t\t\t\t\t$('#image-uploaded').text(response.data.name || '');\n\t\t\t\t\t$('#slide-image').val(response.data.image || '');\n\t\t\t\t\timgUrl = response.data.url || imgUrl;\n\t\t\t\t}\n\n\t\t\t\t$form.find('label.button')\n\t\t\t\t\t.addClass('icon-upload')\n\t\t\t\t\t.removeClass('icon-loading-small');\n\t\t\t\t$('#welcome_img_loading').hide();\n\t\t\t},\n\t\t\terror: function (xhr) {\n\t\t\t\tlet msg = t('nmc_welcome_popup', 'Image upload failed');\n\n\t\t\t\t// 422 (Unprocessable Entity) – typischer Uploadfehler\n\t\t\t\tif (xhr.status === 422) {\n\t\t\t\t\tif (xhr.responseJSON && xhr.responseJSON.data && xhr.responseJSON.data.message) {\n\t\t\t\t\t\tmsg = xhr.responseJSON.data.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmsg = t('nmc_welcome_popup', 'The uploaded file is too large or invalid.');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Falls andere Fehler einen \"status: failure\" Wrapper nutzen\n\t\t\t\telse if (xhr.responseJSON && xhr.responseJSON.status === 'failure') {\n\t\t\t\t\tif (xhr.responseJSON.data && xhr.responseJSON.data.message) {\n\t\t\t\t\t\tmsg = xhr.responseJSON.data.message;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tOC.msg.finishedError('#welcome_img_loaded_msg', msg);\n\n\t\t\t\t$form.find('label.button')\n\t\t\t\t\t.addClass('icon-upload')\n\t\t\t\t\t.removeClass('icon-loading-small');\n\n\t\t\t\t$('#welcome_img_loading').hide();\n\t\t\t}\n\t\t});\n\t});\n\n\t$('#add_new_popup').click(function() {\n\t\tvar slideId = $('.slide-list .active').data('id');\n\n\t\tstartLoading();\n\t\t$.post(\n\t\t\tOC.generateUrl('/apps/nmc_welcome_popup/ajax/slideSettings/' + slideId),\n\t\t\tgetParams()\n\t\t).done(function(response) {\n\t\t\tOC.msg.finishedSaving('#welcome_settings_msg', response);\n\t\t\t$('#welcome_settings_loading').hide();\n\t\t\tif ($('#slide-image').val()) {\n\t\t\t\t$('#remove-img').show();\n\t\t\t}\n\t\t}).fail(function(response) {\n\t\t\tOC.msg.finishedError('#welcome_settings_msg', response.responseJSON.data.message);\n\t\t\t$('#welcome_settings_loading').hide();\n\t\t});\n\t});\n\n\t$('.show-preview').click(function(event) {\n\t\tvar lang = $(this).data('lang');\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t\tvar slide_params = getParams().slide;\n\t\tvar image_name = slide_params.image_uploaded;\n\t\tif (!image_name) {\n\t\t\timgUrl = '';\n\t\t} else if (!imgUrl) {\n\t\t\tvar cachebusterImg = Math.round(new Date().getTime() / 1000);\n\t\t\timgUrl = OC.generateUrl('/apps/nmc_welcome_popup/image/' + image_name) + '?v=' + cachebusterImg;\n\t\t}\n\t\tvar langSlide = slide_params[lang];\n\t\tlangSlide.image_url = imgUrl;\n\t\tconsole.log(langSlide);\n\t\tOCP.Loader.loadScript('nmc_welcome_popup', 'nmc_welcome_popup-main.mjs').then(function () {\n\t\t\twindow.OCA.NMC_Welcome_Popup.NcModal.previewSlide([langSlide]);\n\t\t});\n\t\treturn false;\n\t});\n\n\tfunction getParams() {\n\t\tvar en_title = $('#' + en + '-slide-title').val();\n\t\tvar en_primaryBtnLbl = $('#' + en + '-primary-button-label').val();\n\t\tvar en_primaryBtnUrl = $('#' + en + '-primary-button-url').val();\n\t\tvar en_secondaryBtnDesc = $('#' + en + '-secondary-button-desc').val();\n\t\tvar en_text = $('#' + en + '-text').val();\n\n\t\tvar de_title = $('#' + de + '-slide-title').val();\n\t\tvar de_primaryBtnLbl = $('#' + de + '-primary-button-label').val();\n\t\tvar de_primaryBtnUrl = $('#' + de + '-primary-button-url').val();\n\t\tvar de_secondaryBtnDesc = $('#' + de + '-secondary-button-desc').val();\n\t\tvar de_text = $('#' + de + '-text').val();\n\n\t\tvar image_name = $('#slide-image').val();\n\n\t\treturn {\n\t\t\t'slide': {\n\t\t\t\t'en_GB': {\n\t\t\t\t\t'title': en_title,\n\t\t\t\t\t'primary_button_label': en_primaryBtnLbl,\n\t\t\t\t\t'primary_button_url': en_primaryBtnUrl,\n\t\t\t\t\t'secondary_button_desc': en_secondaryBtnDesc,\n\t\t\t\t\t'content': en_text\n\t\t\t\t},\n\t\t\t\t'de_DE': {\n\t\t\t\t\t'title': de_title,\n\t\t\t\t\t'primary_button_label': de_primaryBtnLbl,\n\t\t\t\t\t'primary_button_url': de_primaryBtnUrl,\n\t\t\t\t\t'secondary_button_desc': de_secondaryBtnDesc,\n\t\t\t\t\t'content': de_text\n\t\t\t\t},\n\t\t\t\t'image_uploaded': image_name\n\t\t\t}\n\t\t};\n\t}\n\n\tOCA.NMC_Welcome_Popup.Admin.init(function() {\n\t\t$(slideDataId + '\"' + OCA.NMC_Welcome_Popup.Admin.currentConfig + '\"]').addClass('active');\n\t});\n\n\tvar switchSlide = function(slideId) {\n\t\t$('.slide-list li').removeClass('active');\n\t\t$(slideDataId + '\"' + slideId + '\"]').addClass('active');\n\t\tif ($('#welcome_img_loaded_msg').is(':hidden') === false) {\n\t\t\t$('#welcome_img_loaded_msg').hide();\n\t\t}\n\t\tif ($('#welcome_settings_msg').is(':hidden') === false) {\n\t\t\t$('#welcome_settings_msg').hide();\n\t\t}\n\t\tOCA.NMC_Welcome_Popup.Admin.currentConfig = '' + slideId;\n\t\t$.get(OC.generateUrl('/apps/nmc_welcome_popup/ajax/slideSettings/' + slideId)).done(function(data) {\n\t\t\tif (Object.entries(data).length > 0) {\n\t\t\t\tObject.keys(data).forEach(function(form_section) {\n\t\t\t\t\tif (form_section === en || form_section === de) {\n\t\t\t\t\t\tvar entries = data[form_section];\n\t\t\t\t\t\tObject.keys(entries).forEach(function (configKey) {\n\t\t\t\t\t\t\tvar element = $('#welcome_popup *[data-key=\"' + form_section + '_' + configKey + '\"]');\n\t\t\t\t\t\t\tif (element.is('input') && (element.prop('type') === 'text' || element.prop('type') === 'number' || element.prop('type') === 'url')) {\n\t\t\t\t\t\t\t\telement.val(entries[configKey]);\n\t\t\t\t\t\t\t} else if (element.is('textarea')) {\n\t\t\t\t\t\t\t\telement.val(entries[configKey]);\n\t\t\t\t\t\t\t} else if (element.prop('type') === 'checkbox') {\n\t\t\t\t\t\t\t\tvar value = entries[configKey] === '1' ? '1' : '0';\n\t\t\t\t\t\t\t\telement.val(value);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.log('unable to find element for ' + configKey);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (form_section === 'image_uploaded') {\n\t\t\t\t\t\t$('#slide-image').val(data[form_section]);\n\t\t\t\t\t\tif ($('#slide-image').val()) {\n\t\t\t\t\t\t\t$('#remove-img').show();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$('#remove-img').hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (form_section === 'image_url') {\n\t\t\t\t\t\timgUrl = data[form_section];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar element = $('#welcome_popup *[data-key]');\n\t\t\t\telement.val('');\n\t\t\t\t$('#slide-image').val('');\n\t\t\t\t$('#remove-img').hide();\n\t\t\t}\n\t\t\tvar imgName = $('#image-name');\n\t\t\timgName.val(imgName.data('key') + '_' + slideId);\n\t\t\t$('#image-uploaded').text('');\n\t\t\t$('input:checkbox[value=\"1\"]').attr('checked', true);\n\t\t\t$('input:checkbox[value=\"0\"]').attr('checked', false);\n\t\t});\n\t};\n\n\taddSlideBtn.on('click', function() {\n\t\tOCA.NMC_Welcome_Popup.Admin.addSlide(function (nextId) {\n\t\t\tvar slideIds = OCA.NMC_Welcome_Popup.Admin.slideIds.split(',');\n\t\t\t$('<li data-id=\"' + nextId + '\"><a>Slide ' + slideIds.length + '</a></li>').insertBefore(addSlideBtn[0]);\n\t\t\tswitchSlide(nextId);\n\t\t\tif (slideIds.length >= OCA.NMC_Welcome_Popup.Admin.maxSlides) {\n\t\t\t\taddSlideBtn.hide();\n\t\t\t}\n\t\t});\n\t});\n\n\t$('.slide-list').on('click', 'li:not(.add-slide)', function() {\n\t\tvar slideId = '' + $(this).data('id');\n\t\tswitchSlide(slideId);\n\t});\n\n\t$('#remove_slide').on('click', function() {\n\t\tOCA.NMC_Welcome_Popup.Admin.removeSlide(function(currentConfig) {\n\t\t\tOC.msg.finishedSuccess('#remove_slide_msg', 'Slide removed');\n\t\t\tvar slideIds = OCA.NMC_Welcome_Popup.Admin.slideIds.split(',');\n\t\t\tif (OCA.NMC_Welcome_Popup.Admin.noSlides === '0') {\n\t\t\t\t$(slideDataId + '\"' + currentConfig + '\"]').remove();\n\t\t\t\trenameSlides(slideIds);\n\t\t\t\tswitchSlide(slideIds[0]);\n\t\t\t} else {\n\t\t\t\t$(slideDataId + '\"' + currentConfig + '\"]').attr('data-id', slideIds[0]);\n\t\t\t\tswitchSlide(slideIds[0]);\n\t\t\t}\n\t\t\tif (addSlideBtn.is(':hidden')) {\n\t\t\t\taddSlideBtn.show();\n\t\t\t}\n\t\t});\n\t});\n\n\tfunction renameSlides(slideIds) {\n\t\tfor (var id = 0; id < slideIds.length; id++) {\n\t\t\t$(slideDataId + '\"' + slideIds[id] + '\"] a').text(function() {\n\t\t\t\treturn 'Slide ' + (id + 1);\n\t\t\t});\n\t\t}\n\t}\n\n});\n"],"names":["imgUrl","en","de","OCA","key","callback","data","slideIds","nextId","index","config","startLoading","startLoadingImg","addSlideBtn","slideDataId","image_name","slideId","response","e","input","file","$form","url","formData","fieldName","xhr","msg","getParams","event","lang","slide_params","cachebusterImg","langSlide","en_title","en_primaryBtnLbl","en_primaryBtnUrl","en_secondaryBtnDesc","en_text","de_title","de_primaryBtnLbl","de_primaryBtnUrl","de_secondaryBtnDesc","de_text","switchSlide","form_section","entries","configKey","element","value","imgName","currentConfig","renameSlides","id"],"mappings":"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"}